@model WebApplication8.Models.Project

@{
    ViewBag.Title = "Details";
}
<style>
    table.summartTbl {
        table-layout: auto;
        width: 320px;

    }

    table.center {
        margin-left: auto;
        margin-right: auto;
    }
</style>

<h2>Project Details</h2>
<h4 style="color:red">@ViewBag.Error</h4>
<div style=" width:100% ;height:100%">
    @Html.HiddenFor(model => model.ProjectId)
    <hr />
    <div style="float:left; width:40% ">
        <table class="table table-striped table-bordered table-hover" id="dataTables-example">

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.QuotationRef)
                </td>

                <td>
                    @Html.DisplayFor(model => model.QuotationRef)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Code)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Code)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Name)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.ProjectStatusId)
                </td>

                <td>
                    @Html.DisplayFor(model => model.ProjectStatus.Name)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.SalesDate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.SalesDate)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Area.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Area.Name)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Value)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Value)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Discount)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Discount)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Vat)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Vat)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Total)
                </td>

                <td>
                    <p id="Total">@Html.DisplayFor(model => model.Total)</p>
                </td>
            </tr>





            <tr>

                <td>
                    @Html.DisplayNameFor(model => model.SalesType.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.SalesType.Name)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.CustomersType.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.CustomersType.Name)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.SalesMan.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.SalesMan.Name)
                </td>

            </tr>





            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Customer.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Customer.Name)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Designer.Name)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Designer.Name)
                </td>

            </tr>


            <tr class="PaymentTerm ">
                <td style=" background-color:forestgreen">
                    @Html.DisplayNameFor(model => model.ProjectPaymentTerm.Name)
                </td>
                <td>
                    @Html.DisplayFor(model => model.ProjectPaymentTerm.Name)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.QuotationAgreementApprovedby)
                </td>

                <td>
                    @Html.DisplayFor(model => model.QuotationAgreementApprovedby)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.AccountApproval)
                </td>

                <td>
                    @{
                        if (@Model.AccountApproval == true)
                        {
                            @Html.Raw("Approved")

                        }
                        else
                        {
                            @Html.Raw("Pending")
                        }
                    }


                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Deduction)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Deduction)
                </td>
            </tr>

            <tr>
                <td>
                    Net Value
                </td>

                <td>
                    model.Total-model.Deduction
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.DeliveryDate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.DeliveryDate)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.ActualDeliveryDate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.ActualDeliveryDate)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Warranty)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Warranty)
                </td>
            </tr>



            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.Description)
                </td>

                <td>
                    @Html.DisplayFor(model => model.Description)
                </td>
            </tr>



            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.UserCreate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.UserCreate)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.CreateDate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.CreateDate)
                </td>
            </tr>

            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.UserLastUpdate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.UserLastUpdate)
                </td>
            </tr>


            <tr>
                <td>
                    @Html.DisplayNameFor(model => model.LastUpdateDate)
                </td>

                <td>
                    @Html.DisplayFor(model => model.LastUpdateDate)
                </td>
            </tr>
        </table>

        @if (User.IsInRole("ProjectViewAttachment") || User.IsInRole("Admin"))
        {
            <div>
                @if (@ViewBag.AttachedFiles == null)
                {<p>  No attachments was uploaded</p>}
                else
                {

                    @*<a href="~/Uploads/CustomerDoc/@ViewBag.Contract_Copy.Name" target="_blank">@ViewBag.Contract_Copy.Name</a>   ,
                    <span> valid until: @ViewBag.Contract_Copy.ValidUntil</span>*@
                    @Html.Raw("  Attachments  : <br/>")
                    foreach (var f in ViewBag.AttachedFiles)
                    {

                        <a href="~/Uploads/CustomerDoc/@f.Name" target="_blank"  >@f.Name</a> <br />

                    }

                }


            </div>
        }
        @if (Model.CuttingSheets.Count == 0  && Model.AccountApproval == true)
        {
            <div style="padding-top:15px">
                @Html.ActionLink("Create MRF", "create", "CuttingSheets", new { ProjectId = Model.ProjectId }, htmlAttributes: new { @class = "btn btn-default" })
            </div>
        }
    </div>

    @{
        var indianCulture = new System.Globalization.CultureInfo("hi-IN");

    }
    <div style="float:left ;height:100%  ; padding-left:50px; width:60%">

        <div id="paymentDiv"></div>

        <div id="SummaryDiv" style="margin-top:30px;">

            <table class="table table-striped table-bordered table-hover  summartTbl center" id="dataTables-example">
                <tr>
                    <td><b>Value</b></td>
                    <td><b> @Html.DisplayFor(model => model.Value)</b></td>
                </tr>

                <tr>
                    <td><b>Discount</b></td>
                    <td><b> @Html.DisplayFor(model => model.Discount)</b></td>
                </tr>

                <tr>
                    <td><b>Vat</b></td>
                    <td><b> @Html.DisplayFor(model => model.Vat)</b></td>
                </tr>

                <tr>
                    <td><b>Total</b></td>
                    <td><b id="Total">   @Html.DisplayFor(model => model.Total)</b></td>
                </tr>

                <tr>
                    <td><b>Total Payment</b></td>
                    <td><b id="totalPayment"> @string.Format(indianCulture, "{0:N}", @ViewBag.totalPayment)  </b></td>
                </tr>

                <tr>
                    <td>
                        <b>Deduction</b>
                        <button id="calculate" type="button" onclick="openChildDeduction()" class="fa fa-plus-square" style="margin-left:20px">Update </button>
                    </td>
                    <td>
                        <b id="Deduction">
                            @if (Model.Deduction == null)
                            {

                                @Html.Raw("0");
                            }
                            else
                            {
                                @Html.DisplayFor(model => model.Deduction)
                            }
                        </b>
                    </td>

                    <td><p id="DeductionReason">  @Model.DeductionReason</p></td>
                </tr>
                @{

                    if (Model.Deduction == null)
                    {
                        Model.Deduction = 0;
                    }

                    double balance = Model.Total - @ViewBag.totalPayment - @Model.Deduction ?? 0;
                    balance = Math.Round(balance, 2);

                }

                <tr>
                    <td><b>Balance</b></td>
                    <td><b id="balance">@string.Format(indianCulture, "{0:N}", @balance)   </b></td>
                </tr>


            </table>




        </div>

        @if (User.IsInRole("Account"))
        {
            <div style="margin-top:30px;  padding-left:160px">
                @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "SearchForm" }))
                {
                    @Html.AntiForgeryToken();
                    <!-- START SEARCH -->

                    <div class="panel-body">


                        <h4 style="color:red">@ViewBag.Error</h4>
                        <div class="form-group">
                            @Html.Label(" ", htmlAttributes: new { @class = "control-label col-md-2" })


                            <div class="col-md-10">
                                <p>
                                    <input type="hidden" value="@Model.ProjectId" name="ProjectId" />
                                    @if (Model.AccountApproval == true)
                                    {
                                        <input type="checkbox" id="test5" name="AccountApprovalCk" value="true" checked />
                                    }
                                    else
                                    {

                                        <input type="checkbox" id="test5" name="AccountApprovalCk" value="true" />
                                    }


                                    <label for="test5">Account Approval</label>


                                </p>


                                <button class="btn btn-primary" id="saveBtn">Save</button>

                            </div>
                        </div>


                    </div>


                    <!-- END SEARCH -->
                }
            </div>
        }

    </div>

    <div style="height:1980px">
        <p>

        </p>
    </div>

</div>

<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.ProjectId }) |
    @Html.ActionLink("Back to List", "Index")
</p>

    }


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")


    <script>

        $(document).ready(function () {

            PaymentDetails();
            // Handler for .ready() called.
        });
        function PaymentDetails() {

            //  alert($("#DeliveryDet").val());
            var ProjectId = $('#ProjectId').val();



            $.ajax({
                type: "GET",

                url: "/Payments/IndexByProject",
                data: { "ProjectId": ProjectId  /* add other additional parameters */ },
                success: function (data) {
                    $("#paymentDiv").empty();
                    $("#paymentDiv").html(data);

                    document.body.scrollTop = 0;
                    document.documentElement.scrollTop = 0;
                },
                Error: function (data) {
                    $("#paymentDiv").val("data");
                }
            });


        };
    </script>



    <script>

        $("#other").click(function () {

            $.ajax({
                type: "GET",

                url: "/Payments/IndexByProject",
                data: { "ProjectId": ProjectId  /* add other additional parameters */ },
                success: function (data) {
                    $("#paymentDiv").empty();
                    $("#paymentDiv").html(data);

                    document.body.scrollTop = 0;
                    document.documentElement.scrollTop = 0;
                },
                Error: function (data) {
                    $("#paymentDiv").val("data");
                }
            });

            $("#target").click();
        });

    </script>
    <script>


        function openChildDeduction() {
            //alert(@ViewBag.ProjectId);

            var myurl = "/Projects/AddDeduction?ProjectId=" + '@Model.ProjectId' ; //etc


            showModalPopUp(myurl)
           // showModalPopUp('/Payments/CreateByProject/'+@ViewBag.ProjectId);

        }
    </script>


    <script type="text/javascript">

        var popUpObj;

        function showModalPopUp(url) {

            popUpObj = window.open(url,

                "ModalPopUp",

                "toolbar=no," +

                "scrollbars=no," +

                "location=no," +

                "statusbar=no," +

                "menubar=no," +

                "resizable=0," +

                "width=960," +

                "height=480," +

                "left = 290," +

                "top=200"

            );

            popUpObj.focus();

            LoadModalDiv();

        }

    </script>


    <script>
        function setValue(a, r) {

            $('#Deduction').html(a);

            $('#DeductionReason').html(r);
            var totalPayment = $('#totalPayment').html().trim().replace(",","");

            var balance = parseFloat("@Model.Total") - parseFloat(totalPayment) - parseFloat(a);
           // alert(totalPayment);

            $('#balance').html(thousands_separators(balance.toFixed(1)));
        }

        function thousands_separators(num) {
            var num_parts = num.toString().split(".");
            num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return num_parts.join(".");
        }
    </script>

}
